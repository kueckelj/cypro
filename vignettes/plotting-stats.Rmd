---
title: "Statistic Related Plots"
output: 
   html_document:
    df_print: paged
    toc: true
    toc_depth: 3
---

```{r folding, include = F}

hooks = knitr::knit_hooks$get()

hook_foldable = function(type) {
  force(type)
  function(x, options) {
    res = hooks[[type]](x, options)
    
    if (isFALSE(options[[paste0("fold.", type)]])) return(res)
    
    paste0(
      "<details><summary>", type, "</summary>\n\n",
      res,
      "\n\n</details>"
    )
  }
}

knitr::knit_hooks$set(
  output = hook_foldable("output"),
  plot = hook_foldable("plot")
)

```

```{r setup, include = F}

knitr::opts_chunk$set(echo = T, fold.output = T, fold.plot = F, fig.show = "hold", out.width = "50%", message = F)

devtools::load_all()

object <- readRDS(file = "data/bids-week4.RDS")
#object_tracks <- readRDS(file = "data/example-tracks.RDS")

object <- subsetByFilter(object, "normal-cells", AreaShape_MeanRadius < 50)



```

## Prerequisites

Make sure to be familiar with the following tutorials before proceeding: 

- [Terminology](terminology.html)
- [Extract Data](extract-data.html)


## 1. Introduction 

Statistic related plots are indispensable in proper data analysis. `cypro` offers functions for all established plot types. This tutorial guides you through all of them and explains how their most important arguments work.

```{r setup-vis, eval = F, echo = T}

# load packages
library(cypro)

# load object from broad institute compound profiling experiment week 4
# contains one time imaging data
object <- readRDS(file = "data/bids-week4.RDS")


```


## 2. Numeric variables

Statistical plotting functions that handle continuous numeric data variables are split in two sub groups. 

1. Plots that allow for visualization of statistical tests. (Boxplot & Violinplot)
2. Plots that do not allow for visualization of statistical tests. (Histogram, Densityplot & Ridgeplot)

Throughout this section we visualize the differences in shape related data variables. 

```{r get-example-vars}

# all area related variables 
getStatVariableNames(object, starts_with("AreaShape"))

# selected ones whose properties make sense to be compared against each other
vars_of_interest <- 
  getStatVariableNames(object,
                       starts_with("AreaShape") & 
                       contains(c("Max", "Min", "Mean", "Median", "Solidity", "Ecc")) &
                        -contains("Bounding")
                       )

vars_of_interest

```


### 2.1 Histograms & Densityplots

Use the functions `plotHistogram()` and `plotDensityplot()` to visualize each. 

```{r basic-distr, fig.cap = "Figure 2.1 Basic densityplots and histograms."}

# basic densityplot
plotDensityplot(object, variables = vars_of_interest[1:4])

# plot histogram
plotHistogram(object, variables = vars_of_interest[5:8], clrp = "jco")

```

Both functions can be used in a comparative manner by specifying a grouping variable via the `across` argument. 

```{r grouping-options}

getGroupingVariableNames(object)

getGroupNames(object, grouping_variable = "condition")

conds_of_interest <- c("DMSO", "5-fluorouracil", "taxol", "tunicamycin")

```

```{r comp-distr, fig.cap = "Figure 2.2 Distributions across a condition, suboptimal choice of plots"}

# histograms are not suited for comparative plotting
plotHistogram(object, 
                variable = vars_of_interest[1:4], 
                across = "condition", 
                across_subset = conds_of_interest, 
                relevel = TRUE,
                clrp = "npg" # change colorpanel as color now refers to groups
                ) + legendBottom()

# densityplots have their drawbacks, too
plotDensityplot(object, 
                variable = vars_of_interest[1:4], 
                across = "condition", 
                across_subset = conds_of_interest, 
                relevel = TRUE,
                clrp = "npg", # change colorpanel as color now refers to groups
                alpha = 0.75 # increase transperancy
                ) + legendBottom()

```

### 2.2 Ridgeplots 

To plot continuous variables in a comparative manner while using the style of densityplots we recommend ridgeplots, accesible through the function `plotRidgeplot()`.


```{r ridge-plot, out.width = "50%", fig.cap = "Figure 2.3 Ridgplots to compare across cell groups"}

# first four vars
plotRidgeplot(object,
              variable = vars_of_interest[1:4], 
              across = "condition", 
              across_subset = conds_of_interest, 
              relevel = TRUE,
              clrp = "npg") + legendNone()

# last four vars
plotRidgeplot(object,
              variable = vars_of_interest[5:8], 
              across = "condition", 
              across_subset = conds_of_interest, 
              relevel = TRUE,
              clrp = "npg") + legendNone()

```


### 2.3 Boxplots and Violinplots

Each plot comes with its own respective function, namely `plotBoxplot()` and `plotViolinplot()`.

```{r box-violin-wo-stats, fig.cap = "Figure 2.4 Boxplots and violinplots"}

# first four vars
plotBoxplot(object,
            variable = vars_of_interest[1:4],
            across = "condition",
            across_subset = conds_of_interest,
            relevel = TRUE,
            display_points = TRUE, 
            pt_size = 1,
            pt_shape = 19,
            clrp = "npg") + legendNone()

# last four vars
plotViolinplot(object,
               variable = vars_of_interest[5:8], 
               across = "condition", 
               across_subset = conds_of_interest, 
               relevel = TRUE,
               clrp = "npg") + legendNone()


```

Statistical tests can either be performed pairwise (e.g. *t-test*) or groupwise (e.g. *anova*). The respective arguments are named accordingly. 

```{r box-violin-w-stats, fig.cap = "Figure 2.5 Boxplots and violinplots with t-test and anova."}

# first four vars
plotBoxplot(object,
            variable = vars_of_interest[1:4],
            across = "condition",
            across_subset = conds_of_interest,
            test_pairwise = "t.test",
            ref_group = "DMSO",
            step_increase = 0.2, # adjust the p-value bar hight
            clrp = "npg") + legendNone()

# last four vars
plotViolinplot(object,
               variable = vars_of_interest[5:8], 
               across = "condition", 
               across_subset = conds_of_interest, 
               test_groupwise = "anova",
               clrp = "npg") + legendNone()


```

## 3. Caterogical variables

(coming soon)

## 4. Interactive plotting 

The function `plotStatisticsInteractive()` gives access to an interactive graphical user interface in which most of the functionalities introduced in Section 2 and 3 can be used interactively. Plots can be immediately exported as .PNG or .pdf files. 

```{r plot-interactive, eval = F}

ploStatisticsInteractive(object)

```

```{r plot-interactive-eval, echo = F, out.width = "100%", fig.cap = "4.1 Interface of plotStatisticsInteractive()"}

knitr::include_graphics(path = "images/plot-statistics-interactive.PNG")

```



