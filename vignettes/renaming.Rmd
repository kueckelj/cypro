---
title: "Rename Content"
output: 
   html_document:
    df_print: paged
---

```{r folding, include = F}

hooks = knitr::knit_hooks$get()

hook_foldable = function(type) {
  force(type)
  function(x, options) {
    res = hooks[[type]](x, options)
    
    if (isFALSE(options[[paste0("fold.", type)]])) return(res)
    
    paste0(
      "<details><summary>", type, "</summary>\n\n",
      res,
      "\n\n</details>"
    )
  }
}

knitr::knit_hooks$set(
  output = hook_foldable("output")
)

```

```{r setup, include = F}

knitr::opts_chunk$set(echo = T, fold.output = T)

devtools::load_all()

object <- readRDS(file = "data/bids-week4.RDS")

```

## Prerequisites

Make sure to be familiar with the following tutorials before proceeding: 

- [Extract Data](extract-data.html)
- [Variable Sets](variable-sets.html)

## 1. Introduction

There are several situations in which renaming of variables or groups is desirable. `cypro` provides functions to do that conveniently even in the light of the multitude of variables researchers are confronted during quantification of automated imaging experiments. As this includes implementation of the well thoght out renaming system of the [tidyverse](https://www.tidyverse.org/) knowledge around the packages `stringr`, `stringi` and `dplyr` is helpful (though not necessary).  Renaming content is possible via two types of functions: 

1. Simple `rename*()`-functions rename individual content one by one with the syntax *new_name* = *old_name*. It implements the concept of `dplyr::rename()`

2. `rename*With()`- functions implement `dplyr::rename_with()` that allows to rename variables with functions. They require knowledge about the 
`stringr` package but are quite powerful with a bit of practice. 

```{r setup-vis, eval = F, echo = T}

# load packages
library(cypro)
library(tidyverse)

# load object from broad institute compound profiling experiment week 4
# contains one time imaging data
object <- readRDS(file = "data/bids-week4.RDS")

```

## 2. Renaming variables 

The statistic data.frame obtained via `getStatsDf()` contains the variables according to which cells are profiled in `cypro` as they carry the summarising information of them. `renameStatsDf()` 

```{r get-stat-variables}

stat_vars <- getStatVariableNames(object)

print(stat_vars[1:5])

```

For instance, renaming area related variables might be useful as the redundant prefix forces a lot of unnecessary typing. However, this approach can get quite cumbersome in case of more than 300 variables whose names, too, could be adjusted to more concise versions for more convenient analysis with less typing. 

```{r rename-stats}

object <- renameStatsDf(object, Area = AreaShape_Area)

# notice the renamed first variable
getStatVariableNames(object)

```


This is where `renameStatsDfWith()` comes in handy. Two examples: 

```{r rename-stats-with}

# replace the AreaShape prefix with a shorter version 
object <- renameStatsDfWith(object, .fn = ~ str_replace_all(.x, pattern = "AreaShape_", replacement = "AS_"))

getStatVariableNames(object)

# remove the redundant _Actin ...
object <-
  renameStatsDfWith(
    object = object,
    .fn = ~ str_remove_all(.x, pattern = "_Actin"),
    # ... only from variables that start with Intensity or RadialDistribution
    .cols = starts_with(c("Intensity", "RadialDistribution")) 
    )

getStatVariableNames(object)

```

Renaming all other variables apart from protected ones like *cell_id*, *condition* or *cell_line* works in a similar fashion. Use `renameMetaDf()`, 
`renameMetaDfWith()`, `renameClusterDf()` and `renameClusterDfWith()` for that matter. 

```{r rename-cluster}

getClusterVariableNames(object)

# if only intensity based clustering results exist and you don't plan to add any more you might 
# want to cut the suffix

object <- renameClusterDfWith(object, .fn = ~ str_remove_all(.x, pattern = "_\\(intensity\\)"))

getClusterVariableNames(object)  

```



## 3. Renaming groups

Group names are often suboptimal. For instance, clustering algorithms return numbers as names for cluster. This is rarely informative and if your analysis results in the identification of biologically meaningfully subgroups you might want to rename these groups accordingly. Use `renameGroups()` for that matter. It works with the same *new_name* = *old_name* syntax as the `rename*()` functions mentioned previously. 

```{r rename groups}

getGroupNames(object = object, grouping_variable = "pam_euclidean_k_4")

object <- 
  renameGroups(object, 
               grouping_variable = "pam_euclidean_k_4", 
               "round_shape" = "1", # new_name = old_name
               "long_shape" = "2", 
               "rectangular_like" = "3", 
               "triangular_like" = "4"
               )

getGroupNames(object, grouping_variable = "pam_euclidean_k_4")

getClusterDf(object) %>% 
  select(cell_id, pam_euclidean_k_4)

```


