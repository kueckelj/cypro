---
title: "Variable Sets"
output: 
   html_document:
    df_print: paged
---

```{r folding, include = F}

hooks = knitr::knit_hooks$get()

hook_foldable = function(type) {
  force(type)
  function(x, options) {
    res = hooks[[type]](x, options)
    
    if (isFALSE(options[[paste0("fold.", type)]])) return(res)
    
    paste0(
      "<details><summary>", type, "</summary>\n\n",
      res,
      "\n\n</details>"
    )
  }
}

knitr::knit_hooks$set(
  output = hook_foldable("output"),
  plot = hook_foldable("plot")
)

```

```{r setup, include = F}

knitr::opts_chunk$set(echo = T, fold.output = T, fold.plot = F)

devtools::load_all()

object <- readRDS(file = "data/bids-week4.RDS")

object@variable_sets$area <- NULL

```

## Prerequisites

Make sure to be familiar with the following tutorials before proceeding: 

- [Extract data, 4. Variable names](extract-data.html#variable-names)

## 1. Introduction

The number of data variables that can result from high throughput microscopy experiments is vast. The examples we use throughout our tutorials often contain more than 300 of them. In order to keep track and do proper, convenient analysis we implemented a concept called *Variable Sets*. Variable sets are predefined sets of variable names gathered under a specific name. This, for one thing, facilitates analysis as it often saves a lot of manual typing. Additionally, it helps to keep track of the different perspectives from which you can analyze cells as well as it helps to compare the results. 

```{r setup-vis, eval = F, echo = T}

# load packages
library(cypro)
library(tidyverse)

# load object from broad institute compound profiling experiment week 4
# contains one time imaging data
object <- readRDS(file = "data/bids-week4.RDS")

```

## 2. Create a variable set

Let's assume that the current question at hand is all around the cells shape and variables regarding intensity, granularity etc. are not of interest. 

```{r all-var-names}

all_var_names <- getStatVariableNames(object)

all_var_names

```

The selection helpers introduced [here](extract-data.html#variable-names) are a good start to select the variables of interest. 

```{r area-vars}

area_variables <- getStatVariableNames(object, starts_with("AreaShape") & -contains(c("Zernike", "Center")))

area_variables

```

Using the function `addVariableSet()` we can store these variables as a defined group in the *cto* object and name that group. In this case we name the group of variables *shape* as this is what they describe. 

```{r add-vset}

object <- addVariableSet(object, variable_names = shape_variables, set_name = "area")

# obtain all stored variable set names with which to refer to them
getVariableSetNames(object)

```

In case you need this defined set of variables as a character vector use `getVariableSet()`. 

```{r get-vset}

getVariableSet(object, variable_set = "area")

```

How useful these variable sets are is exemplified in particular in the tutorials on [dimensional reduction](), [clustering]() and [correlation](). 


